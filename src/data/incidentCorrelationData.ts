/**
 * Mock data for Incident Correlation & Root Cause Analysis
 */

import type {
  NetworkIncident,
  IncidentMetrics,
  CorrelationPattern,
  IncidentCorrelationData,
} from '../types/incidentCorrelation';

export const incidentMetrics: IncidentMetrics = {
  totalIncidents: 247,
  activeIncidents: 3,
  resolvedToday: 12,
  avgResolutionTime: '2.4 hours',
  mttr: '1.8 hours',
  mttd: '3.2 minutes',
  automatedResolution: 67,
  falsePositives: 8,
  criticalIncidents: 2,
  highSeverityIncidents: 1,
};

export const networkIncidents: NetworkIncident[] = [
  {
    id: 'INC-2024-001',
    title: 'Database Connection Pool Exhaustion - Payment Service',
    description: 'Payment service experiencing connection pool exhaustion leading to failed transactions and elevated error rates across payment processing pipeline',
    severity: 'critical',
    status: 'investigating',
    category: 'performance',
    detectedAt: '2024-01-19T14:23:15Z',
    acknowledgedAt: '2024-01-19T14:24:30Z',
    detectionSource: 'AI Anomaly Detection',
    assignedTeam: 'Platform Engineering',
    assignedTo: 'Sarah Chen',
    impact: {
      affectedUsers: 15420,
      affectedServices: 5,
      affectedRegions: ['us-east-1', 'eu-west-1', 'ap-southeast-1'],
      estimatedRevenueLoss: 127500,
      slaViolations: 3,
      downtime: '47 minutes',
    },
    timeline: [
      {
        timestamp: '2024-01-19T14:15:00Z',
        event: 'Payment service latency begins increasing from 45ms to 250ms',
        source: 'APM Monitoring',
        severity: 'medium',
        affectedComponents: ['payment-service'],
      },
      {
        timestamp: '2024-01-19T14:18:30Z',
        event: 'Database connection pool utilization reaches 95%',
        source: 'Database Monitoring',
        severity: 'high',
        affectedComponents: ['payment-db-primary'],
      },
      {
        timestamp: '2024-01-19T14:21:00Z',
        event: 'API Gateway reports 504 Gateway Timeout errors from payment service',
        source: 'API Gateway Logs',
        severity: 'high',
        affectedComponents: ['api-gateway', 'payment-service'],
      },
      {
        timestamp: '2024-01-19T14:23:15Z',
        event: 'AI correlation engine identifies cascading failure pattern',
        source: 'AI Anomaly Detection',
        severity: 'critical',
        affectedComponents: ['payment-service', 'order-service', 'notification-service'],
      },
      {
        timestamp: '2024-01-19T14:24:30Z',
        event: 'Incident acknowledged by on-call engineer',
        source: 'Incident Management',
        severity: 'critical',
        affectedComponents: [],
      },
    ],
    correlatedEvents: [
      {
        id: 'EVT-001',
        timestamp: '2024-01-19T14:10:00Z',
        source: 'Load Balancer',
        message: 'Traffic spike detected: 3.2x normal load',
        severity: 'medium',
        category: 'network',
        correlationScore: 95,
        affectedServices: ['api-gateway', 'payment-service'],
      },
      {
        id: 'EVT-002',
        timestamp: '2024-01-19T14:12:30Z',
        source: 'Database',
        message: 'Slow query detected: payment_transactions table scan (1.2s avg)',
        severity: 'high',
        category: 'performance',
        correlationScore: 92,
        affectedServices: ['payment-db-primary'],
      },
      {
        id: 'EVT-003',
        timestamp: '2024-01-19T14:18:45Z',
        source: 'Application Logs',
        message: 'Connection timeout errors increasing: 45 errors/min',
        severity: 'high',
        category: 'availability',
        correlationScore: 88,
        affectedServices: ['payment-service', 'order-service'],
      },
      {
        id: 'EVT-004',
        timestamp: '2024-01-19T14:20:00Z',
        source: 'User Service',
        message: 'Retry queue depth increasing: 1,247 pending operations',
        severity: 'medium',
        category: 'performance',
        correlationScore: 78,
        affectedServices: ['user-service'],
      },
    ],
    rootCauseAnalysis: {
      primaryCause: 'Database connection pool misconfiguration combined with unoptimized query causing connection exhaustion under traffic spike',
      confidence: 'high',
      confidenceScore: 94,
      contributingFactors: [
        'Connection pool max size set to 50 (insufficient for current load)',
        'Missing index on payment_transactions.created_at column',
        'Long-running transactions not properly timing out',
        'Traffic spike from promotional campaign (3.2x normal load)',
        'Connection leak in payment processing error handling path',
      ],
      evidencePoints: [
        'Database metrics show connection pool at 100% utilization',
        'Query execution time increased 15x during incident window',
        'No database failover or infrastructure issues detected',
        'Connection pool monitoring shows gradual exhaustion pattern',
        'Similar pattern observed in staging during load test last week',
      ],
      affectedComponents: [
        'payment-service',
        'payment-db-primary',
        'api-gateway',
        'order-service',
        'notification-service',
      ],
      propagationPath: [
        'payment-db-primary',
        'payment-service',
        'api-gateway',
        'order-service',
        'notification-service',
      ],
      estimatedImpactRadius: 5,
    },
    remediationPlan: {
      recommendedSteps: [
        {
          order: 1,
          action: 'Immediately increase connection pool max size from 50 to 150',
          owner: 'Platform Engineering',
          estimatedDuration: '5 minutes',
          automationAvailable: true,
          riskLevel: 'low',
          dependencies: [],
        },
        {
          order: 2,
          action: 'Add missing index on payment_transactions.created_at column',
          owner: 'Database Team',
          estimatedDuration: '10 minutes',
          automationAvailable: true,
          riskLevel: 'low',
          dependencies: [1],
        },
        {
          order: 3,
          action: 'Implement connection timeout of 30s for payment service',
          owner: 'Platform Engineering',
          estimatedDuration: '15 minutes',
          automationAvailable: false,
          riskLevel: 'medium',
          dependencies: [1],
        },
        {
          order: 4,
          action: 'Deploy connection leak fix in error handling code path',
          owner: 'Payment Team',
          estimatedDuration: '20 minutes',
          automationAvailable: false,
          riskLevel: 'medium',
          dependencies: [1, 2],
        },
        {
          order: 5,
          action: 'Verify metrics return to normal and monitor for 30 minutes',
          owner: 'Platform Engineering',
          estimatedDuration: '30 minutes',
          automationAvailable: false,
          riskLevel: 'low',
          dependencies: [1, 2, 3, 4],
        },
      ],
      alternativeApproaches: [
        'Scale out payment service horizontally (add 3 more instances)',
        'Failover to secondary database with higher connection limits',
        'Implement circuit breaker to prevent cascade failures',
      ],
      preventionMeasures: [
        'Implement dynamic connection pool sizing based on load',
        'Add database query performance monitoring alerts',
        'Perform load testing before promotional campaigns',
        'Implement connection pool metrics dashboards',
        'Add automated index analysis to CI/CD pipeline',
      ],
      estimatedTotalTime: '1.5 hours',
      automationPotential: 65,
    },
    similarIncidents: [
      {
        id: 'INC-2023-847',
        title: 'Order Service Database Connection Pool Exhaustion',
        occurredAt: '2023-12-08T09:15:00Z',
        similarity: 87,
        resolution: 'Increased connection pool size and added missing indexes',
        resolutionTime: '2.3 hours',
        rootCause: 'Connection pool misconfiguration with unoptimized queries',
      },
      {
        id: 'INC-2023-623',
        title: 'Payment Processing Degradation During Black Friday',
        occurredAt: '2023-11-24T18:45:00Z',
        similarity: 78,
        resolution: 'Scaled database connections and optimized query patterns',
        resolutionTime: '3.1 hours',
        rootCause: 'Insufficient capacity planning for traffic spike',
      },
    ],
    tags: ['database', 'performance', 'connection-pool', 'payment-service', 'high-impact'],
    attachments: ['connection-pool-metrics.png', 'query-analysis.pdf', 'incident-timeline.json'],
    notes: [
      'Similar pattern detected in staging environment last week during load testing',
      'Payment team was already working on connection management improvements',
      'Consider implementing connection pool monitoring for all critical services',
    ],
  },
  {
    id: 'INC-2024-002',
    title: 'BGP Route Leak - Network Connectivity Loss',
    description: 'Accidental BGP route advertisement causing traffic black-holing in US-WEST region affecting multiple services',
    severity: 'critical',
    status: 'active',
    category: 'network',
    detectedAt: '2024-01-19T13:45:22Z',
    acknowledgedAt: '2024-01-19T13:46:15Z',
    detectionSource: 'Network Monitoring',
    assignedTeam: 'Network Operations',
    assignedTo: 'Michael Rodriguez',
    impact: {
      affectedUsers: 8900,
      affectedServices: 12,
      affectedRegions: ['us-west-2'],
      estimatedRevenueLoss: 95000,
      slaViolations: 5,
      downtime: '1 hour 12 minutes',
    },
    timeline: [
      {
        timestamp: '2024-01-19T13:40:00Z',
        event: 'BGP configuration change deployed to edge router RTR-USW-01',
        source: 'Change Management',
        severity: 'low',
        affectedComponents: ['RTR-USW-01'],
      },
      {
        timestamp: '2024-01-19T13:42:30Z',
        event: 'Incorrect BGP route (10.0.0.0/8) advertised to upstream provider',
        source: 'BGP Monitoring',
        severity: 'high',
        affectedComponents: ['RTR-USW-01', 'ISP-Upstream'],
      },
      {
        timestamp: '2024-01-19T13:45:22Z',
        event: 'Packet loss detected across US-WEST region (78% packet loss)',
        source: 'Network Monitoring',
        severity: 'critical',
        affectedComponents: ['us-west-2'],
      },
      {
        timestamp: '2024-01-19T13:46:15Z',
        event: 'Network team acknowledges critical incident',
        source: 'Incident Management',
        severity: 'critical',
        affectedComponents: [],
      },
    ],
    correlatedEvents: [
      {
        id: 'EVT-101',
        timestamp: '2024-01-19T13:40:05Z',
        source: 'Change Control',
        message: 'Configuration change CHG-20240119-045 deployed',
        severity: 'low',
        category: 'configuration',
        correlationScore: 98,
        affectedServices: ['network-infrastructure'],
      },
      {
        id: 'EVT-102',
        timestamp: '2024-01-19T13:43:00Z',
        source: 'Router Telemetry',
        message: 'Routing table size spike detected: 850K -> 1.2M routes - Unexpected routing table expansion',
        severity: 'high',
        category: 'network',
        correlationScore: 96,
        affectedServices: ['network-infrastructure'],
      },
      {
        id: 'EVT-103',
        timestamp: '2024-01-19T13:45:00Z',
        source: 'Load Balancer',
        message: 'Health checks failing across US-WEST region',
        severity: 'critical',
        category: 'availability',
        correlationScore: 91,
        affectedServices: ['web-app', 'api-gateway', 'auth-service'],
      },
    ],
    rootCauseAnalysis: {
      primaryCause: 'BGP route filter misconfiguration allowed internal network prefix (10.0.0.0/8) to be advertised to upstream ISP, causing traffic black-holing',
      confidence: 'high',
      confidenceScore: 97,
      contributingFactors: [
        'Missing route filter validation in BGP configuration',
        'Change deployed without proper peer review',
        'Automated validation checks did not catch route leak',
        'No staging environment for BGP configuration testing',
        'Route prefix list not updated for new internal subnets',
      ],
      evidencePoints: [
        'BGP routing tables show 10.0.0.0/8 advertised to AS64512',
        'Configuration diff confirms route-map filter was removed',
        'Upstream ISP logs show route acceptance timestamp matches incident',
        'Traceroute shows traffic routing through ISP and not returning',
        'Other regions unaffected, confirming localized misconfiguration',
      ],
      affectedComponents: [
        'RTR-USW-01',
        'us-west-2',
        'web-app',
        'api-gateway',
        'auth-service',
        'payment-service',
      ],
      propagationPath: [
        'RTR-USW-01',
        'ISP-Upstream',
        'us-west-2-network',
        'all-services-us-west-2',
      ],
      estimatedImpactRadius: 12,
    },
    remediationPlan: {
      recommendedSteps: [
        {
          order: 1,
          action: 'Immediately withdraw incorrect BGP route advertisement',
          owner: 'Network Operations',
          estimatedDuration: '2 minutes',
          automationAvailable: true,
          riskLevel: 'low',
          dependencies: [],
        },
        {
          order: 2,
          action: 'Restore previous BGP configuration from backup',
          owner: 'Network Operations',
          estimatedDuration: '5 minutes',
          automationAvailable: true,
          riskLevel: 'low',
          dependencies: [1],
        },
        {
          order: 3,
          action: 'Add route filter for 10.0.0.0/8 prefix to prevent future leaks',
          owner: 'Network Engineering',
          estimatedDuration: '10 minutes',
          automationAvailable: false,
          riskLevel: 'medium',
          dependencies: [2],
        },
        {
          order: 4,
          action: 'Verify routing convergence across all edge routers',
          owner: 'Network Operations',
          estimatedDuration: '15 minutes',
          automationAvailable: false,
          riskLevel: 'low',
          dependencies: [3],
        },
      ],
      alternativeApproaches: [
        'Fail over traffic to US-EAST region while fixing BGP',
        'Contact ISP to manually filter the leaked route',
        'Temporarily disable BGP peering and use static routes',
      ],
      preventionMeasures: [
        'Implement automated BGP configuration validation',
        'Add pre-deployment testing for route filters',
        'Require peer review for all BGP changes',
        'Implement route leak detection and auto-remediation',
        'Create staging environment for network changes',
      ],
      estimatedTotalTime: '45 minutes',
      automationPotential: 75,
    },
    similarIncidents: [
      {
        id: 'INC-2023-512',
        title: 'BGP Route Leak - EU Region',
        occurredAt: '2023-09-15T11:23:00Z',
        similarity: 92,
        resolution: 'Withdrew incorrect route and added prefix filters',
        resolutionTime: '1.2 hours',
        rootCause: 'BGP configuration error during maintenance',
      },
    ],
    tags: ['network', 'bgp', 'routing', 'critical', 'configuration-error'],
    attachments: ['bgp-routing-table.txt', 'config-diff.txt', 'network-topology.png'],
    notes: [
      'Similar incident occurred in EU region 4 months ago',
      'Need to implement automated BGP validation in CI/CD',
      'Consider implementing RPKI for route origin validation',
    ],
  },
  {
    id: 'INC-2024-003',
    title: 'Redis Cache Cluster Failover - Authentication Delays',
    description: 'Redis primary node failure triggering automatic failover causing temporary authentication service degradation',
    severity: 'high',
    status: 'resolved',
    category: 'availability',
    detectedAt: '2024-01-19T11:15:08Z',
    acknowledgedAt: '2024-01-19T11:16:30Z',
    resolvedAt: '2024-01-19T11:42:15Z',
    detectionSource: 'Infrastructure Monitoring',
    assignedTeam: 'Infrastructure',
    assignedTo: 'Alex Kumar',
    impact: {
      affectedUsers: 4200,
      affectedServices: 3,
      affectedRegions: ['us-east-1'],
      estimatedRevenueLoss: 18000,
      slaViolations: 1,
      downtime: '27 minutes',
    },
    timeline: [
      {
        timestamp: '2024-01-19T11:12:00Z',
        event: 'Redis primary node memory usage reaches 95%',
        source: 'Infrastructure Monitoring',
        severity: 'medium',
        affectedComponents: ['redis-primary'],
      },
      {
        timestamp: '2024-01-19T11:15:08Z',
        event: 'Redis primary node becomes unresponsive (OOM condition)',
        source: 'Redis Monitoring',
        severity: 'critical',
        affectedComponents: ['redis-primary'],
      },
      {
        timestamp: '2024-01-19T11:15:45Z',
        event: 'Automatic failover initiated to redis-replica-01',
        source: 'Redis Sentinel',
        severity: 'high',
        affectedComponents: ['redis-cluster'],
      },
      {
        timestamp: '2024-01-19T11:17:30Z',
        event: 'Authentication service experiencing increased latency (250ms -> 1.2s)',
        source: 'APM',
        severity: 'high',
        affectedComponents: ['auth-service'],
      },
      {
        timestamp: '2024-01-19T11:35:00Z',
        event: 'New redis primary fully synced and serving traffic',
        source: 'Redis Sentinel',
        severity: 'medium',
        affectedComponents: ['redis-cluster'],
      },
      {
        timestamp: '2024-01-19T11:42:15Z',
        event: 'All services returned to normal performance',
        source: 'APM',
        severity: 'low',
        affectedComponents: ['auth-service', 'user-service'],
      },
    ],
    correlatedEvents: [
      {
        id: 'EVT-201',
        timestamp: '2024-01-19T11:10:00Z',
        source: 'Redis',
        message: 'Memory usage increasing rapidly: 85% -> 95% in 2 minutes',
        severity: 'high',
        category: 'capacity',
        correlationScore: 93,
        affectedServices: ['redis-primary'],
      },
      {
        id: 'EVT-202',
        timestamp: '2024-01-19T11:16:00Z',
        source: 'Auth Service',
        message: 'Cache miss rate spiking: 5% -> 78%',
        severity: 'high',
        category: 'performance',
        correlationScore: 89,
        affectedServices: ['auth-service'],
      },
    ],
    rootCauseAnalysis: {
      primaryCause: 'Redis primary node ran out of memory due to session data accumulation without proper TTL expiration, triggering OOM and automatic failover',
      confidence: 'high',
      confidenceScore: 91,
      contributingFactors: [
        'Session keys created without TTL (Time To Live) expiration',
        'Memory eviction policy set to noeviction instead of allkeys-lru',
        'No monitoring alerts for cache key count growth',
        'Session cleanup job not running since 2024-01-15',
        'Insufficient memory allocated for current load (8GB vs 12GB needed)',
      ],
      evidencePoints: [
        'Redis key count increased from 2.1M to 4.8M over 4 days',
        'Memory analysis shows 72% used by session: keys',
        'TTL analysis reveals 3.2M keys with no expiration set',
        'Session cleanup job logs show last run 4 days ago',
        'No evidence of memory leak in application code',
      ],
      affectedComponents: ['redis-primary', 'auth-service', 'user-service'],
      propagationPath: ['redis-primary', 'auth-service', 'user-service', 'web-app'],
      estimatedImpactRadius: 3,
    },
    remediationPlan: {
      recommendedSteps: [
        {
          order: 1,
          action: 'Set default TTL of 24 hours for all session keys',
          owner: 'Platform Engineering',
          estimatedDuration: '10 minutes',
          automationAvailable: true,
          riskLevel: 'low',
          dependencies: [],
        },
        {
          order: 2,
          action: 'Change Redis eviction policy from noeviction to allkeys-lru',
          owner: 'Infrastructure',
          estimatedDuration: '5 minutes',
          automationAvailable: true,
          riskLevel: 'medium',
          dependencies: [],
        },
        {
          order: 3,
          action: 'Restart session cleanup job and verify execution',
          owner: 'Platform Engineering',
          estimatedDuration: '10 minutes',
          automationAvailable: false,
          riskLevel: 'low',
          dependencies: [],
        },
        {
          order: 4,
          action: 'Increase Redis memory allocation from 8GB to 12GB',
          owner: 'Infrastructure',
          estimatedDuration: '15 minutes',
          automationAvailable: false,
          riskLevel: 'medium',
          dependencies: [1, 2, 3],
        },
      ],
      alternativeApproaches: [
        'Implement Redis cluster sharding for better memory distribution',
        'Move sessions to dedicated session store (separate Redis cluster)',
        'Implement client-side session management with JWT tokens',
      ],
      preventionMeasures: [
        'Add monitoring alerts for Redis key count growth',
        'Implement automated TTL policy enforcement',
        'Schedule regular Redis key pattern analysis',
        'Add memory capacity planning dashboards',
        'Implement session cleanup job health monitoring',
      ],
      estimatedTotalTime: '40 minutes',
      automationPotential: 80,
    },
    similarIncidents: [
      {
        id: 'INC-2023-723',
        title: 'Redis Memory Exhaustion - Cache Service',
        occurredAt: '2023-10-12T14:20:00Z',
        similarity: 84,
        resolution: 'Added TTL policies and increased memory allocation',
        resolutionTime: '1.1 hours',
        rootCause: 'Unbounded cache key growth without expiration',
      },
    ],
    tags: ['redis', 'cache', 'availability', 'failover', 'memory'],
    attachments: ['redis-memory-analysis.txt', 'key-pattern-report.csv'],
    notes: [
      'Automatic failover worked as designed, minimal impact',
      'Need to implement better cache key management practices',
      'Consider implementing Redis monitoring dashboards for all clusters',
    ],
  },
];

export const correlationPatterns: CorrelationPattern[] = [
  {
    id: 'PATTERN-001',
    name: 'Database Connection Exhaustion Cascade',
    description: 'Pattern of connection pool exhaustion leading to cascading failures across dependent services',
    occurrences: 8,
    lastSeen: '2024-01-19T14:23:15Z',
    avgImpact: 'High - affects 4-6 services',
    services: ['payment-service', 'order-service', 'user-service'],
    confidence: 87,
  },
  {
    id: 'PATTERN-002',
    name: 'BGP Configuration Change Impact',
    description: 'Network configuration changes causing routing issues and connectivity loss',
    occurrences: 5,
    lastSeen: '2024-01-19T13:45:22Z',
    avgImpact: 'Critical - regional outage',
    services: ['network-infrastructure'],
    confidence: 92,
  },
  {
    id: 'PATTERN-003',
    name: 'Cache Failover Authentication Degradation',
    description: 'Redis/cache failures causing authentication service slowdown during failover',
    occurrences: 12,
    lastSeen: '2024-01-19T11:15:08Z',
    avgImpact: 'Medium - temporary degradation',
    services: ['auth-service', 'user-service', 'redis-cluster'],
    confidence: 78,
  },
  {
    id: 'PATTERN-004',
    name: 'Traffic Spike Capacity Threshold',
    description: 'Unexpected traffic spikes exceeding capacity thresholds causing performance degradation',
    occurrences: 15,
    lastSeen: '2024-01-19T14:10:00Z',
    avgImpact: 'Medium-High - service degradation',
    services: ['api-gateway', 'payment-service', 'web-app'],
    confidence: 81,
  },
  {
    id: 'PATTERN-005',
    name: 'Slow Query Performance Cascade',
    description: 'Unoptimized database queries causing connection buildup and downstream failures',
    occurrences: 18,
    lastSeen: '2024-01-19T14:12:30Z',
    avgImpact: 'High - multi-service impact',
    services: ['database-services', 'api-services'],
    confidence: 85,
  },
];

export const incidentCorrelationData: IncidentCorrelationData = {
  incidents: networkIncidents,
  metrics: incidentMetrics,
  correlationPatterns,
  lastUpdated: '2024-01-19T15:00:00Z',
};
